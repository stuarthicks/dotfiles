#!/usr/bin/env zsh

path_has() {
  if echo "$PATH" | tr ':' '\n' | grep -x -q "$1" ; then
    return 0
  else
    return 1
  fi
}

path_append() {
  if ! path_has "$1" ; then
    PATH="$PATH:$1"
  fi
}

path_prepend() {
  if path_has "$1" ; then
    PATH="${PATH//":$1"/}"
    PATH="${PATH//"$1:"/}"
  fi
  PATH="$1:$PATH"
}

path_tidy() {
  PATH="$(echo "$PATH" | awk -v RS=':' -v ORS=":" '!a[$1]++{if (NR > 1) printf ORS; printf $a[$1]}')"
}

java-opt() {
  export JAVA_TOOL_OPTIONS="$1 $JAVA_TOOL_OPTIONS"
}

maven-opt() {
  export MAVEN_OPTS="$1 $MAVEN_OPTS"
}

just-configurate() {
  cosmos-ssh-to-any just-configurator $1 just-configurate
}

link-ssh() {
  pushd $HOME/.ssh
  if [ "$(readlink config)" != "$1" ]; then
    rm config; ln -s "$1" config
  fi
  popd
}

jars-in-war() {
  unzip -l *-war/target/*-SNAPSHOT.war | grep jar | awk -F '/' '{print $3}' | sort -u
}

stack-diff() {
  local STACK_TYPE=$1
  local ENVIRONMENT=$2
  dbus-launch --exit-with-session vimdiff -g tmp/templates/template-${STACK_TYPE}.${ENVIRONMENT}.*
  dbus-launch --exit-with-session vim -g tmp/templates/description-${STACK_TYPE}.${ENVIRONMENT}.next.json
}

go-here() {
  export GOPATH="${pwd}"
  export PATH="$GOPATH/bin:$PATH"
}

# Set title of window
title () {
    printf "\033k$1\033\\"
}

# Echo path with newlines
path () {
    echo $PATH | tr : $'\n'
}

# List all items on path
lspath () {
  (($#)) || set ''
  print -lr -- $^path/*$^@*(N:t) | sort -u
}

wgetar () {
    wget -q0 - "$1" | tar xzvf -
}

do-it-live () {
  cosmos-deploy -f $1 test && cosmos-deploy -f $1 live
}

sans() {
  openssl s_client -connect "$1:443" 2>/dev/null </dev/null | openssl x509 -noout -text | grep -A1 'Subject Alternative Name'
}
