# vi: set filetype=sh tabstop=2 shiftwidth=2 expandtab :

[ -f /etc/environment ] && . /etc/environment

readonly red=$(tput setaf 1)
readonly green=$(tput setaf 2)
readonly blue=$(tput setaf 6)
readonly reset=$(tput sgr0)

if [ "${STACK_ENV%%-*}" = 'prod' ]; then
  readonly env_col=$red
else
  readonly env_col=$blue
fi

export PS1="${env_col}${AWS_ZONE} ${STACK_ENV} ${STACK_GROUP} ${green}\h ${blue}\w
\$${reset} "

alias l='ls --color --group-directories-first -lah'
alias k=l

alias d=docker
alias e=etcdctl
alias f=fleetctl
alias s=systemctl

alias cloudinit='journalctl --identifier=coreos-cloudinit'

ctop() {
  docker run -ti -v /var/run/docker.sock:/var/run/docker.sock quay.io/vektorlab/ctop:latest
}

dl_ncdu() {
  curl -sSLfO 'https://dev.yorhel.nl/download/ncdu-linux-i486-1.12.tar.gz'
  tar xzvf ncdu-linux-i486-1.12.tar.gz
}

j() {
  if [ $# = 1 ] && [ "${1##*.}" = "service" ]; then
    journalctl -u "$1" -n100 -f
  else
    journalctl "$@"
  fi
}

u() {
  if [ $# -eq 0 ]; then
    fleetctl list-units
  else
    fleetctl list-units \
      | grep "$@"
  fi
}

uf() {
  if [ $# -eq 0 ]; then
    fleetctl list-unit-files
  else
    fleetctl list-unit-files \
      | grep "$@"
  fi
}

service() {
  fleetctl list-units \
  | grep "$1" \
  | cut -f1 \
  | sort -u \
  | xargs -n1 fleetctl "$2"
}

echo "TOOLBOX_DOCKER_TAG=24" >>$HOME/.toolboxrc
