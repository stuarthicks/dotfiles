#!/usr/bin/env ruby
require 'openssl'
require 'highline/import'
require 'awesome_print'
require 'pry'

@cert_path = ARGV[0]
@cert_pass = ask("Enter the password for the p12: ") { |q| q.echo = false }

p12 = OpenSSL::PKCS12.new(File.read(@cert_path), @cert_pass)

subject = p12.certificate.subject.to_a.map {|a| a.reverse.drop(1).reverse }.to_h
subject["expires"] = p12.certificate.not_after

cas = p12.ca_certs.map do |c| 
  m = c.subject.to_a.map {|a| a.reverse.drop(1).reverse }.to_h
  m["expires"] = c.not_after
  m
end

puts "Chain of authority:"
ap cas

puts "This certificate:"
ap subject
